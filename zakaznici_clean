CREATE OR REPLACE TABLE ZAKAZNICI_CLEAN AS
SELECT "cislo" ID_ZAKAZNIK,
    "nazev" NAZEV,
    SPLIT_PART("nazev", ' ', 1) AS PRVNI,
    SPLIT_PART("nazev", ' ', 2) AS DRUHA,
    SPLIT_PART("nazev", '.', 1) AS TRETI,
    "obec" OBEC,
    "ulice" ULICE,
    "dic" DIC,
    "ico" ICO
FROM "czechitas-klienti-vystup-list-1";

ALTER TABLE ZAKAZNICI_CLEAN ADD COLUMN SUBJEKT VARCHAR(100);

UPDATE ZAKAZNICI_CLEAN SET SUBJEKT = CASE WHEN ICO != '' OR DIC != '' OR NAZEV ILIKE '%s.r.o.%' OR NAZEV ILIKE '%a.s.%' OR NAZEV ILIKE '%v.o.s.%' THEN 'pravnicka_osoba' ELSE 'fyzicka_osoba' END;

CREATE OR REPLACE TABLE ZAKAZNICI_CLEAN AS
SELECT ID_ZAKAZNIK,
    NAZEV,
    PRVNI,
    DRUHA,
    TRETI,
    OBEC,
    ULICE,
    SUBJEKT,
    F.SEX ZENA,
    M.SEX MUZ,
    CASE WHEN F.SEX = 'female' THEN 'ZENA'
        WHEN M.SEX = 'male' THEN 'MUZ'
        ELSE 'Neznamo' END AS POHLAVI
FROM ZAKAZNICI_CLEAN AS Z
LEFT JOIN "female-list-1" AS F
ON Z.PRVNI = F.NAME OR Z.DRUHA = F.NAME OR Z.TRETI = F.NAME
LEFT JOIN "male-list-1" AS M
ON Z.PRVNI = M.NAME OR Z.DRUHA = M.NAME OR Z.TRETI = M.NAME;

UPDATE ZAKAZNICI_CLEAN SET "ID_ZAKAZNIK" = '00000' || "ID_ZAKAZNIK" WHERE LENGTH("ID_ZAKAZNIK") = 1;

UPDATE ZAKAZNICI_CLEAN SET "ID_ZAKAZNIK" = '0000' || "ID_ZAKAZNIK" WHERE LENGTH("ID_ZAKAZNIK") = 2;

UPDATE ZAKAZNICI_CLEAN SET "ID_ZAKAZNIK" = '000' || "ID_ZAKAZNIK" WHERE LENGTH("ID_ZAKAZNIK") = 3;

UPDATE ZAKAZNICI_CLEAN SET "ID_ZAKAZNIK" = '00' || "ID_ZAKAZNIK" WHERE LENGTH("ID_ZAKAZNIK") = 4;

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'praha' WHERE "OBEC" ILIKE '%praha%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'brno' WHERE "OBEC" ILIKE '%brno%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'ostrava' WHERE "OBEC" ILIKE '%ostrava%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'cesky krumlov' WHERE "OBEC" ILIKE '%cesky krumlov%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'hradec kralove' WHERE "OBEC" ILIKE '%hradec kralove%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'frydek mistek' WHERE "OBEC" ILIKE '%frydek-mistek%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'praha' WHERE "OBEC" ILIKE '%prague%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'ceske budejovice' WHERE "OBEC" ILIKE '%ceske budejovice%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'chomutov' WHERE "OBEC" ILIKE '%chomutov%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'decin' WHERE "OBEC" ILIKE '%decin%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'liberec' WHERE "OBEC" ILIKE '%liberec%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'plzen' WHERE "OBEC" ILIKE '%plzen%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'praha' WHERE "OBEC" ILIKE '%prha%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'zlin' WHERE "OBEC" ILIKE '%zlin%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'breclav' WHERE "OBEC" ILIKE '%breclav%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'kladno' WHERE "OBEC" ILIKE '%kladno%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'klatovy' WHERE "OBEC" ILIKE '%klatovy%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'jesenik' WHERE "OBEC" ILIKE '%jesenik%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'jicin' WHERE "OBEC" ILIKE '%jicin%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'jihlava' WHERE "OBEC" ILIKE '%jihlava%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'mlada boleslav' WHERE "OBEC" ILIKE '%mlada boleslav%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'opava' WHERE "OBEC" ILIKE '%opava%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'pardubice' WHERE "OBEC" ILIKE '%pardubice%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'olomouc' WHERE "OBEC" ILIKE '%olomouc%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'pribram' WHERE "OBEC" ILIKE '%pribram%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'prostejov' WHERE "OBEC" ILIKE '%prostejov%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'praha' WHERE "OBEC" ILIKE '%prag%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'praha' WHERE "OBEC" ILIKE '%prahs%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'svitavy' WHERE "OBEC" ILIKE '%svitavy%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'tabor' WHERE "OBEC" ILIKE '%tabor%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'trutnov' WHERE "OBEC" ILIKE '%trutnov%';

UPDATE ZAKAZNICI_CLEAN SET "OBEC" = 'valasske mezirici' WHERE "OBEC" ILIKE '%valasske mezirici%';

ALTER TABLE ZAKAZNICI_CLEAN DROP COLUMN ZENA, MUZ;
